# MngLocalDev ユーザーマニュアル

このアプリケーションは、Windows (WSL2 / Docker) 上でのPHP開発環境やバージョン管理、プロジェクトごとのPHP割り当て（Nginx + PHP-FPM）をGUIで管理するためのツールです。
phpenvを利用して複数のPHPバージョンを管理し、簡単に切り替えることができます。

---

## 画面構成と機能

### 1. PHP Manager (統合管理)

PHPのプロジェクト割り当て（Assignments）と、インストール済みバージョン（Versions）を1つの画面で管理します。上部のタブで表示を切り替えます。

#### **Assignments (プロジェクト割り当て)**
プロジェクトごとに使用するPHPバージョンやポート番号を管理します。

*   **新規作成 (New Assignment)**:
    1.  「New Assignment」ボタンをクリックします。
    2.  プロジェクトパスを選択し、使用するPHPバージョンを指定します。
    3.  **PHP-FPM Port**: PHP-FPMが利用する待ち受けポートです（例: `9000`）。
    4.  **URL Path**: アクセス時のURLを指定します。ポート番号を含めることが可能です（例: `localhost:8082/test3`）。
    5.  **Document Root**: プロジェクトの公開ディレクトリ（WSL側のパス）を指定します。

*   **操作**:
    *   **Start/Stop**: 指定したポートでPHP-FPMプロセスを開始・停止します。
    *   **Edit/Delete**: 設定の変更や削除を行います。

#### **Versions (バージョン管理)**
phpenvを利用して、PHPのインストールとアンインストールを行います。

*   **インストール (Install New)**:
    *   一覧からバージョンを選択してインストールします。バックグラウンドでビルドが行われるため、完了まで時間がかかる場合があります。
*   **アンインストール (Uninstall)**:
    *   不要になったPHPバージョンを削除します。

---

## ポートの取り扱いについて（重要）

本システムでは、Nginx（Dockerコンテナ）とPHP-FPM（Windowsホスト）の間で2種類のポートが利用されます。

### 1. PHP-FPM 側のポート (FPM Port)
*   **役割**: Windows上で動作する個別のPHP-FPMプロセスが通信を待ち受けるためのポートです。
*   **設定**: アサインメントごとに `9000`, `9001` のようにユニークな番号を割り当てます。
*   **通信**: Nginxコンテナからは `host.docker.internal:[FPM Port]` を通じてPHPの処理が依頼されます。

### 2. Nginx 側のポート (Web Port)
*   **役割**: ブラウザからアクセスする際のポート番号です。
*   **設定**: `URL Path` に指定した値から自動的に解析されます。
    *   例: `localhost:8082/test3` と入力した場合、**8082** が外部受付ポートになります。
*   **自動公開**: 「Docker Manager」で **"Rebuild / Update"** を実行すると、解析されたすべてのポートが `docker-compose.yml` に自動的に書き出され、Dockerコンテナのポート80へマッピングされます（例: `8082:80`）。
*   **パスの解決**: `/test3` のようなサブパス形式が指定された場合、Nginxの `alias` 機能を用いて正しいドキュメントルートへルーティングされます。

---

### 2. MySQL Manager
Docker上で動作するMySQLデータベースを管理します。

*   **Database操作**: データベースの作成・削除。
*   **Table操作**: テーブル一覧の表示、行数・サイズの確認、データ閲覧（先頭100件）、DDL（定義）の表示。
*   **SQL実行**: 任意のSQL（テーブル作成など）をエディタで実行できます。
*   **インポート**: `.sql` ファイルや `.csv/.tsv` データのインポートに対応しています。

### 3. Cron Manager
WSL上のシステムクローン（crontab）をGUIで一括管理します。

*   **Jobs (ジョブ管理)**:
    *   **スケジュール設定**: Cron書式（`分 時 日 月 曜日`）でジョブを登録します。
    *   **状態監視**: ジョブ毎の実行履歴（開始時間、終了時間、終了コード）を10秒おきに自動更新して表示します。
    *   **Save and Apply**: 保存と同時にWSL側の `/etc/cron.d/` へ設定が即時反映されます。
*   **Environment (環境変数)**:
    *   Cron実行環境全体に適用される共通環境変数（`PATH`, `TZ`など）を設定します。
*   **Wrappers (ラッパー定義)**:
    *   コマンドの共通プレフィックスを定義できます（例: `PHP_CMD` を `/usr/bin/php` として定義）。
    *   ジョブのコマンド内で `${PHP_CMD}` のように使用することで、可読性とメンテナンス性を向上させます。

#### **⚠️ 重要：WSL2での実行について**
Cron機能を利用するには、WSL2およびCronデーモンが動作している必要があります。

1.  **起動状態の維持**: WSL2は全てのターミナルやアプリケーションを閉じると停止します。停止中はCronジョブも実行されません。
2.  **Cronの有効化 (OracleLinux等)**:
    WSL上のターミナルで以下のコマンドを実行して、Cronサービスをインストール・起動してください。
    ```bash
    # インストール (未導入の場合)
    sudo dnf install -y cronie
    
    # サービスの開始
    sudo crond
    ```
    ※ WSL2の標準設定ではPC再起動時にCronが自動起動しないため、PC起動後に一度ターミナル等で `sudo crond` を実行する必要があります。

### 4. Docker Manager
開発環境を支えるコンテナ群の状態管理を行います。

*   **環境構築 (Rebuild / Update)**: アサインメントの設定に基づき、Nginxの設定ファイル（`default.conf`）と `docker-compose.yml` を自動生成し、環境を最新の状態に更新します。
*   **状態監視**: 各コンテナ（Nginx, MySQL, Couchbaseなど）の起動・停止、再起動を行えます。
*   **設定の永続化**: 生成された設定ファイルは `C:\Projects\localmng\phpenv_nginx` に保存され、Dockerから参照されます。

### 5. Couchbase Manager
Docker上で動作するCouchbase Serverの状態管理とファイルのアップロードを行います。

*   **Console (コンソール)**:
    *   CouchbaseのWeb管理画面（ポート8091）へブラウザでアクセスします。
    *   初期セットアップやバケットの作成などはここから行います。
*   **File Upload (アップロード)**:
    *   ファイルを Couchbase のバケット内へドキュメントとして保存します。
    *   ファイル名がそのまま「キー」となり、ファイルの内容が無加工でそのまま「バリュー」として格納されます。
    *   テキスト、HTML、画像、バイナリなど、あらゆるファイル形式をそのまま KV ストアとして保存するのに適しています。

---

## 注意事項

*   **設定の反映**: アサインメントを追加・変更した後は、必ず **Docker Manager** の **"Rebuild / Update"** ボタンを押して設定を反映させてください。
*   **WSL2**: 本ツールは `phpenv` が WSL2 上にインストールされていることを前提としています。

---
&copy; 2026 MngLocalDev Project
